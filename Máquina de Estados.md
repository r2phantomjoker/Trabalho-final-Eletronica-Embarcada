O controle central do elevador foi implementado no arquivo main.c utilizando uma Máquina de Estados Finitos (FSM) para gerenciar o comportamento do sistema. A função principal é responsável por orquestrar os drivers de hardware (PWM3, Timers, UART e ADC), garantindo que o elevador atenda às solicitações de forma otimizada e segura, respeitando os tempos de parada e reversão exigidos.

O fluxo de execução inicia com a inicialização dos periféricos via MCC e a habilitação das interrupções globais e periféricas, incluindo o Timer 4 para o cálculo de velocidade em segundo plano. No loop principal, o sistema monitora constantemente a chegada de novos comandos via Bluetooth através da função UART_RecebePedido e atualiza o estado dos sensores S1 a S4. A decisão de movimento é tomada por um algoritmo de varredura (Scan) implementado diretamente na máquina de estados com auxílio das funções Existe_Chamada_Acima e Existe_Chamada_Abaixo. Essa lógica prioriza o atendimento de todas as chamadas no sentido atual de deslocamento (caronas) antes de permitir a inversão de direção. Caso não existam solicitações pendentes e o elevador não esteja no térreo, o sistema gera automaticamente um comando de retorno à posição de repouso (Andar 0).

A máquina de estados alterna entre cinco modos de operação. No modo Parado, o sistema aguarda novas instruções. Ao iniciar o movimento (Subindo ou Descendo), o motor é acionado através do módulo PWM3, e o sistema monitora continuamente os sensores de fim de curso. Por questões de segurança, a detecção dos sensores extremos (S1 na descida ou S4 na subida) provoca o desligamento imediato do motor, independentemente da lógica de controle, prevenindo danos mecânicos.

Ao atingir um andar de destino, o sistema transita para o estado de Espera Porta, onde permanece imóvel por 2 segundos para simular a abertura de portas. Após esse período, o sistema entra automaticamente no estado de Reversão por 500ms antes de aceitar novos comandos. Esse atraso garante a parada total do eixo e a proteção da Ponte H contra correntes reversas bruscas. Paralelamente ao controle de movimento, o sistema envia pacotes de telemetria a cada 300ms contendo o status atual, posição, velocidade e temperatura.
