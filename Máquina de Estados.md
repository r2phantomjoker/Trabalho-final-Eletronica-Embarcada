O controle central do elevador foi implementado no arquivo main.c utilizando uma Máquina de Estados Finitos (FSM) para gerenciar o comportamento do sistema. A função principal é responsável por orquestrar os drivers de hardware (PWM3, Timers, UART e ADC) desenvolvidos pelos demais integrantes, garantindo que o elevador atenda às solicitações de forma otimizada e segura, respeitando os tempos de parada e reversão exigidos no roteiro.

O fluxo de execução inicia com a inicialização dos periféricos via MCC e a habilitação das interrupções globais e periféricas, incluindo o Timer 4 para o cálculo de velocidade em segundo plano. No loop principal, o sistema monitora constantemente a chegada de novos comandos via Bluetooth através da função UART_RecebePedido e atualiza o estado dos sensores S1 a S4. A decisão de movimento é tomada por um algoritmo de varredura (Scan) implementado na função Buscar_Proxima_Parada, que prioriza o atendimento de todas as chamadas no sentido atual de deslocamento antes de permitir a inversão de direção. Caso não existam solicitações pendentes e o elevador não esteja no térreo, o sistema gera automaticamente um comando de retorno à posição de repouso (Andar 0).

A máquina de estados alterna entre cinco modos de operação. No modo Parado, o sistema aguarda novas instruções. Ao iniciar o movimento (Subindo ou Descendo), o motor é acionado através do módulo PWM3, e o sistema monitora continuamente os sensores de fim de curso. Por questões de segurança, a detecção dos sensores extremos (S1 na descida ou S4 na subida) provoca o desligamento imediato do motor, independentemente da lógica de controle, prevenindo danos mecânicos.

Ao atingir um andar de destino, o sistema transita para o estado de Espera, onde permanece imóvel por 2 segundos para simular a abertura de portas. Antes de retomar o movimento, a lógica verifica o próximo destino na fila; caso seja necessário inverter o sentido de rotação do motor, o sistema entra obrigatoriamente no estado de Reversão por 500ms. Esse atraso garante a proteção da Ponte H e das engrenagens contra reversões bruscas. Paralelamente ao controle de movimento, o sistema envia pacotes de telemetria a cada 300ms contendo o status atual, posição, velocidade e temperatura, cumprindo os requisitos de comunicação sem bloquear o processamento principal.